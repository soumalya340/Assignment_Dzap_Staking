<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/Dzap_NFT_Staking.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> Dzap_NFT_Staking.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>24/24</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">77.08% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>37/48</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">93.33% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>14/15</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>47/47</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">17×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">30×</span>
<span class="cline-any cline-yes">30×</span>
<span class="cline-any cline-yes">30×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">30×</span>
<span class="cline-any cline-yes">30×</span>
<span class="cline-any cline-yes">30×</span>
<span class="cline-any cline-yes">30×</span>
<span class="cline-any cline-yes">30×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">15×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">31×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;
&nbsp;
import "@openzeppelin/contracts/token/ERC721/IERC721.sol";
import "@openzeppelin/contracts/token/ERC20/IERC20.sol";
import "@openzeppelin/contracts-upgradeable/access/OwnableUpgradeable.sol";
import "@openzeppelin/contracts-upgradeable/proxy/utils/Initializable.sol";
import "@openzeppelin/contracts-upgradeable/proxy/utils/UUPSUpgradeable.sol";
&nbsp;
/// @title DzapNFTStaking
/// @notice This contract allows users to stake NFTs and earn ERC20 token rewards
/// @dev This contract is upgradeable and uses OpenZeppelin's upgradeable contracts
contract DzapNFTStaking is Initializable, OwnableUpgradeable, UUPSUpgradeable {
    IERC721 public nftContract;
    IERC20 public rewardToken;
    uint256 public rewardPerBlock;
    uint256 public delayPeriod;
    uint256 public unbondingPeriod;
    bool private _pause;
&nbsp;
    /// @notice Struct to store information about staked assets
    struct AssetInfo {
        address owner;
        uint256 lastblock;
        uint256 unbondingEndTime;
        uint256 untstakingEndBlock;
        AssetStatus status;
    }
&nbsp;
    /// @notice Enum to represent the status of an asset
    enum AssetStatus {
        NOTSTAKED,
        STAKED,
        UNSTAKING_IN_PROGRESS,
        UNSTAKED
    }
&nbsp;
    /// @notice Mapping of token IDs to their staking information
    mapping(uint256 =&gt; AssetInfo) public stakedNFTs;
&nbsp;
    /// @notice Mapping of staker addresses to their last reward claim timestamp
    mapping(address =&gt; uint256) public lastClaimTimestamp;
&nbsp;
    /// @notice Modifier to check if the contract is not paused
    modifier whenNotpaused() {
        require(
            _pause == false,
            "DzapNFTStaking: The user cannot proceed, contract is paused"
        );
        _;
    }
&nbsp;
    /// @notice Modifier to check if the caller is the owner of the token
    /// @param tokenId The ID of the token
    modifier onlywhenTokenOwner(uint256 tokenId) {
        require(
            stakedNFTs[tokenId].owner == _msgSender(),
            "DzapNFTStaking: User is not authorized!"
        );
        _;
    }
&nbsp;
    /// @notice Emitted when an NFT is staked
    /// @param user The address of the user who staked the NFT
    /// @param tokenId The ID of the staked NFT
    event NFTStaked(address indexed user, uint256 tokenId);
&nbsp;
    /// @notice Emitted when an NFT is unstaked
    /// @param user The address of the user who unstaked the NFT
    /// @param tokenId The ID of the unstaked NFT
    event NFTUnstaked(address indexed user, uint256 tokenId);
&nbsp;
    /// @notice Emitted when rewards are claimed
    /// @param user The address of the user who claimed rewards
    /// @param amount The amount of rewards claimed
    event RewardsClaimed(address indexed user, uint256 amount);
&nbsp;
    /// @notice Emitted when an NFT is withdrawn
    /// @param user The address of the user who withdrew the NFT
    /// @param tokenId The ID of the withdrawn NFT
    event NFTWithdrawn(address indexed user, uint256 tokenId);
&nbsp;
    /// @notice Initializes the contract
    /// @dev This function is called once when the contract is deployed
    function initialize() public <span class="missing-if-branch" title="else path not taken" >E</span>initializer {
        __Ownable_init(msg.sender);
        __UUPSUpgradeable_init();
        _pause = true; // Start the contract in paused state to prevent actions until it's ready
    }
&nbsp;
    /// @notice Sets the main contract data
    /// @param _nftContract Address of the NFT contract
    /// @param _rewardToken Address of the reward token contract
    /// @param _rewardPerBlock Amount of reward tokens given per block
    /// @param _delayPeriod Delay period for claiming rewards
    /// @param _unbondingPeriod Period for unbonding staked NFTs
    function setContractData(
        address _nftContract,
        address _rewardToken,
        uint256 _rewardPerBlock,
        uint256 _delayPeriod,
        uint256 _unbondingPeriod
    ) external <span class="missing-if-branch" title="else path not taken" >E</span>onlyOwner {
        nftContract = IERC721(_nftContract);
        rewardToken = IERC20(_rewardToken);
        rewardPerBlock = _rewardPerBlock;
        delayPeriod = _delayPeriod;
        unbondingPeriod = _unbondingPeriod;
    }
&nbsp;
    /// @notice Allows a user to stake an NFT
    /// @param tokenId The ID of the NFT to stake
    function stakeNFT(uint256 tokenId) external whenNotpaused {
        require(
            stakedNFTs[tokenId].status == AssetStatus.NOTSTAKED ||
<span class="branch-1 cbranch-no" title="branch not covered" >                stakedNFTs[tokenId].status == AssetStatus.UNSTAKED</span>,
            "DzapNFTStaking: Asset is already staked"
        );
        require(
            nftContract.ownerOf(tokenId) == _msgSender(),
            "User is not authorized"
        );
        nftContract.transferFrom(_msgSender(), address(this), tokenId);
        stakedNFTs[tokenId] = AssetInfo(
            _msgSender(),
            block.number,
            0,
            0,
            AssetStatus.STAKED
        );
        emit NFTStaked(_msgSender(), tokenId);
    }
&nbsp;
    /// @notice Allows a user to initiate the unstaking process for an NFT
    /// @param tokenId The ID of the NFT to unstake
    function unstakeNFT(uint256 tokenId) external onlywhenTokenOwner(tokenId) {
        require(
            stakedNFTs[tokenId].status == AssetStatus.STAKED,
            "DzapNFTStaking: Nft is not staked!"
        );
&nbsp;
        stakedNFTs[tokenId].unbondingEndTime =
            block.timestamp +
            unbondingPeriod;
&nbsp;
        stakedNFTs[tokenId].untstakingEndBlock = block.number;
        stakedNFTs[tokenId].status = AssetStatus.UNSTAKING_IN_PROGRESS;
&nbsp;
        emit NFTUnstaked(_msgSender(), tokenId);
    }
&nbsp;
    /// @notice Allows a user to withdraw their unstaked NFT after the unbonding period
    /// @param tokenId The ID of the NFT to withdraw
    function withdrawNFT(uint256 tokenId) external {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(
            stakedNFTs[tokenId].status == AssetStatus.UNSTAKING_IN_PROGRESS,
            "Invalid asset state"
        );
        require(
            block.timestamp &gt;= stakedNFTs[tokenId].unbondingEndTime,
            "Unbonding period not over"
        );
&nbsp;
        stakedNFTs[tokenId].status = AssetStatus.UNSTAKED;
&nbsp;
        nftContract.transferFrom(
            address(this),
            stakedNFTs[tokenId].owner,
            tokenId
        );
&nbsp;
        emit NFTWithdrawn(_msgSender(), tokenId);
    }
&nbsp;
    /// @notice Allows a user to claim rewards for a staked NFT
    /// @param tokenId The ID of the NFT for which to claim rewards
    function claimRewards(
        uint256 tokenId
    ) external <span class="missing-if-branch" title="else path not taken" >E</span>onlywhenTokenOwner(tokenId) {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(
            stakedNFTs[tokenId].status != AssetStatus.NOTSTAKED,
            "Asset is not staked"
        );
&nbsp;
        <span class="missing-if-branch" title="else path not taken" >E</span>require(
            block.timestamp &gt;= lastClaimTimestamp[_msgSender()] + delayPeriod,
            "Claim delay period not met"
        );
&nbsp;
        uint256 rewards;
&nbsp;
        if (
            stakedNFTs[tokenId].status != AssetStatus.STAKED &amp;&amp;
            stakedNFTs[tokenId].lastblock != 0
        ) {
            uint256 numBlocks = stakedNFTs[tokenId].untstakingEndBlock -
                stakedNFTs[tokenId].lastblock;
&nbsp;
            rewards = numBlocks * rewardPerBlock;
&nbsp;
            stakedNFTs[tokenId].lastblock = 0;
        } else {
            uint256 numBlocks = block.number - stakedNFTs[tokenId].lastblock;
&nbsp;
            rewards = numBlocks * rewardPerBlock;
&nbsp;
            stakedNFTs[tokenId].lastblock = block.number;
        }
&nbsp;
        <span class="missing-if-branch" title="else path not taken" >E</span>require(rewards &gt; 0, "No rewards to claim");
&nbsp;
        lastClaimTimestamp[_msgSender()] = block.timestamp;
&nbsp;
        <span class="missing-if-branch" title="else path not taken" >E</span>require(
            rewardToken.transfer(_msgSender(), rewards),
            "Reward transfer failed"
        );
&nbsp;
        emit RewardsClaimed(_msgSender(), rewards);
    }
&nbsp;
    /// @notice Allows the owner to update the reward per block
    /// @param _newRewardPerBlock The new reward amount per block
    function updateRewardPerBlock(
        uint256 _newRewardPerBlock
    ) external onlyOwner {
        rewardPerBlock = _newRewardPerBlock;
    }
&nbsp;
    /// @notice Allows the owner to pause the contract
    function pause() external onlyOwner {
        _pause = true;
    }
&nbsp;
    /// @notice Allows the owner to unpause the contract
    function unpause() external onlyOwner {
        _pause = false;
    }
&nbsp;
    /// @notice Allows the owner to update the delay period for claiming rewards
    /// @param _newDelayPeriod The new delay period
    function updateDelayPeriod(uint256 _newDelayPeriod) external onlyOwner {
        delayPeriod = _newDelayPeriod;
    }
&nbsp;
    /// @notice Allows the owner to update the unbonding period
    /// @param _newUnbondingPeriod The new unbonding period
    function updateUnbondingPeriod(
        uint256 _newUnbondingPeriod
    ) external onlyOwner {
        unbondingPeriod = _newUnbondingPeriod;
    }
&nbsp;
    /// @notice Internal function to authorize an upgrade
    /// @dev This function is required by the UUPSUpgradeable contract
    /// @param newImplementation Address of the new implementation
<span class="fstat-no" title="function not covered" >    function _authorizeUpgrade(</span>
        address newImplementation
    ) internal override onlyOwner {}
&nbsp;
    /// @notice Returns the version of the contract
    /// @return A string representing the version number
    function version() public pure virtual returns (string memory) {
        return "1.0.0";
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Mon Aug 26 2024 23:04:09 GMT+0530 (India Standard Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
